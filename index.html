<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Basic setup and title from user's code -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Human Time System (HTS) Converters</title>

    <!-- PWA Setup: Link to the Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- PWA Meta Tags (Theme, Apple) -->
    <meta name="theme-color" content="#4f46e5">
    <!-- Using a common icon name for simplicity, assume a 512x512 PNG exists -->
    <link rel="apple-touch-icon" href="icon-512.png"> 
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="HTS Tool">
    <!-- END MOBILE-SPECIFIC PWA ADDITIONS -->

    <style>        
        /* * FIX FOR MOBILE JIGGLE: 
         * 1. Set box-sizing to border-box for predictable widths.
         * 2. Set margin: 0 and explicitly hide horizontal overflow on the body. 
         */
        * {
            box-sizing: border-box;
        }

        body {            
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;            
            display: flex;            
            flex-direction: column;            
            align-items: center;            
            /* Reduced padding to rely on inner container margins for centering */
            padding: 0;            
            background-color: #f0f2f5;        
            
            /* --- JIGGLE FIX START --- */
            margin: 0; 
            overflow-x: hidden;
            width: 100%; /* Ensure body spans full width */
            /* --- JIGGLE FIX END --- */
        }        

        /* === Custom Splash Screen Styles (Updated) === */
        #custom-splash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #007bff; /* Matching manifest theme_color */
            z-index: 9999; /* Ensure it covers everything */
            color: white;
            transition: opacity 0.3s ease-out; /* Smooth fade-out */
            text-align: center;
        }
        
        /* New style for the image on the splash screen - Now Responsive and Larger */
        .splash-logo-image {
            width: 60vw; /* Use 60% of viewport width for responsiveness */
            height: 60vw; /* Keep aspect ratio */
            max-width: 400px; /* Clamp maximum size on desktop */
            max-height: 400px; /* Clamp maximum size on desktop */
            border-radius: 50%; /* Make it circular */
            object-fit: cover; /* Ensures the logo fills the circle, cropping the white canvas space */
            margin-bottom: 20px;
            border: 5px solid white; /* Nice white border */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        /* Style for the main text on the splash screen */
        .splash-caption {
            font-size: 1.8em;
            font-weight: 700;
            color: white;
            padding: 0 20px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            margin-bottom: 5px;
        }

        #custom-splash p {
            margin-top: 10px;
            font-size: 1.2em;
        }
        /* === END Splash Screen Styles === */

        /* Main app content wrapper to handle spacing from the top */
        #app-content {
            padding: 20px 0; /* Add vertical padding */
            width: 100%; /* Ensure it spans the full width */
        }
        
        /* === Centering Fix: Apply margin: auto to containers with fixed max-width === */
        .container {            
            background-color: #ffffff;            
            padding: 40px 20px; /* Adjusted horizontal padding */
            border-radius: 12px;            
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);            
            width: 90%;            
            max-width: 450px;
            /* --- CENTERING FIX START --- */
            margin: 0 auto 30px auto; /* Centers horizontally and adds bottom margin */
            /* --- CENTERING FIX END --- */
            text-align: center;
        }        
        /* Logo Styling */        
        .logo-container {            
            margin-bottom: 25px;        
        }        
        .logo-container img {            
            max-width: 180px;             
            height: auto;            
            display: block;            
            margin: 0 auto;        
        }        
        h1 {            
            color: #1a1a2e;            
            font-size: 1.5em;            
            margin-bottom: 30px;        
        }        
        h2 {            
            color: #1a1a2e;            
            font-size: 1.3em;            
            margin-top: 0;            
            margin-bottom: 25px;        
        }        
        label {            
            display: block;            
            margin-top: 20px;            
            margin-bottom: 8px;            
            font-weight: 600;            
            color: #333;            
            text-align: left;        
        }        
        input {            
            width: 100%;            
            padding: 12px;            
            box-sizing: border-box;            
            border: 2px solid #ccc;            
            border-radius: 6px;            
            font-size: 1em;            
            transition: border-color 0.3s;        
        }        
        input:focus {            
            border-color: #007bff;            
            outline: none;        
        }        
        button {            
            background-color: #007bff;            
            color: white;            
            padding: 12px 25px;            
            margin-top: 30px;            
            border: none;            
            cursor: pointer;            
            border-radius: 6px;            
            font-size: 1em;            
            font-weight: 700;            
            transition: background-color 0.3s, transform 0.1s;        
        }        
        button:hover {            
            background-color: #0056b3;        
        }        
        button:active {            
            transform: scale(0.99);        
        }        
        /* Styling for Result Boxes */        
        #result-convert, #result-difference, #result-project, #result-hts-convert {            
            margin-top: 35px;            
            padding: 20px;            
            border: 1px solid #ddd;            
            border-radius: 8px;            
            background-color: #e6f7ff;            
            font-size: 1.1em;            
            color: #1a1a2e;            
            font-weight: bold;        
        }        
        .warning-text {            
            color: #ff4500; /* Deep Orange for warning */            
            font-weight: 600;            
            font-size: 0.95em;        
        }        
        /* Status Box Styling */        
        .status-box {            
            padding: 15px 20px;
            background-color: #f8f9fa;            
            border: 1px solid #dee2e6;            
            font-size: 0.9em;            
            /* Ensure it has margin at the bottom before the footer */            
            margin: 0 auto 30px auto; /* CENTERING FIX */
            width: 90%;            
            max-width: 450px;         
        }        
        .status-box h2 {            
            font-size: 1.1em;            
            margin-bottom: 10px;            
            color: #007bff;        
        }        
        .status-box p {            
            font-weight: normal;            
            margin: 5px 0;            
            color: #6c757d;        
        }        
        /* Footer/New Logo Styling */        
        footer {            
            margin: 40px auto 40px auto; /* CENTERING FIX */
            padding-top: 20px;            
            border-top: 1px solid #ccc;            
            width: 90%;            
            max-width: 450px;            
            text-align: center;        
        }        
        .storcke-logo img {            
            max-width: 150px;            
            height: auto;            
            opacity: 0.7;        
        }        
        .footer-text {            
            color: #666;            
            font-size: 0.8em;            
            margin-top: 10px;        
        }
        /* Style for the main content block that starts hidden */
        .hidden {
            display: none !important;
        }    
    </style>

</head>
<body>
<!-- === Custom Splash Screen (4-Second Delay) === -->
<div id="custom-splash">
    <!-- Image for daughter's picture -->
    <!-- IMPORTANT: Make sure the SRC below exactly matches the filename you uploaded to your server! -->
    <img 
        id="daughter-photo" 
        src="daughter_photo.jpg" 
        alt="Daughter's Photo" 
        class="splash-logo-image"
        onerror="this.onerror=null; this.src='https://placehold.co/150x150/ffffff/ff0000?text=Image+Missing'"
    >
    <p class="splash-caption">Welcome to the Storcke HTS Tool</p>
    <p>Loading Human Time System Converter...</p>
</div>
<!-- === END Splash Screen === -->

<!-- Wrap all application content in this div and hide it initially -->
<div id="app-content" class="hidden">
    <!-- USER'S APPLICATION UI/HTML CONTENT -->
    <div class="container">    
        <div class="logo-container">        
            <!-- Reverted to original file name as requested -->        
            <img src="1000035855.png" alt="Human Time System Logo">     
        </div>
        <h1>Gregorian Year to HTS Converter</h1>
        <label for="gregorianYear">Enter Gregorian Year (AD):</label>    
        <input type="number" id="gregorianYear" placeholder="e.g., 2025" onkeyup="if(event.key === 'Enter') convertToHTS()">
        <button onclick="convertToHTS()">Calculate HTS Year</button>
        <div id="result-convert">        
            The current year will be displayed here on load.    
        </div>
    </div>
    <!-- HTS to Gregorian Converter -->
    <div class="container">    
        <h2>HTS Year to Gregorian Converter</h2>        
        <label for="htsYearInput">Enter HTS Year (e.g., 1B40000):</label>    
        <input type="text" id="htsYearInput" placeholder="e.g., 1B40000" onkeyup="if(event.key === 'Enter') convertHTSToGregorian()">
        <button onclick="convertHTSToGregorian()">Calculate Gregorian Year</button>
        <div id="result-hts-convert">        
            Enter an HTS year to see the Gregorian equivalent.    
        </div>
    </div>
    <div class="container">    
        <h2>Calculate Year Difference (Duration)</h2>        
        <label for="startYear">Enter Start Gregorian Year:</label>    
        <input type="number" id="startYear" placeholder="e.g., 2025" onkeyup="if(event.key === 'Enter') calculateDifference()">        
        <label for="endYear">Enter End Gregorian Year:</label>    
        <input type="number" id="endYear" placeholder="e.g., 2050" onkeyup="if(event.key === 'Enter') calculateDifference()">
        <button onclick="calculateDifference()">Calculate Duration</button>
        <div id="result-difference">        
            Enter two years to see the duration between them.    
        </div>
    </div>
    <div class="container">    
        <h2>Project Future HTS Year</h2>        
        <label for="baseYear">Start Gregorian Year:</label>    
        <input type="number" id="baseYear" placeholder="e.g., 2025" onkeyup="if(event.key === 'Enter') projectFutureYear()">        
        <label for="yearsToAdd">Number of Years to Add:</label>    
        <input type="number" id="yearsToAdd" placeholder="e.g., 50" onkeyup="if(event.key === 'Enter') projectFutureYear()">
        <button onclick="projectFutureYear()">Calculate Future HTS Year</button>
        <div id="result-project">        
            Enter the number of years to add to see the future HTS Year.    
        </div>
    </div>
    <!-- Last Updated Status Display -->
    <div class="status-box">    
        <h2>Application Status</h2>    
        <div id="last-updated">        
            Calculating load time...    
        </div>
    </div>
    <footer>    
        <div class="storcke-logo">        
            <img src="storcke_hts_logo.png" alt="Storcke HTS Tool">    
        </div>    
        <p class="footer-text">Powered by the Storcke Family Products HTS Tool</p>
    </footer>
</div>
<!-- END Application Content -->

<!-- PWA Service Worker Registration Script (Crucial for Installation) -->
<script>
    // Service Worker registration logic
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
        // Introduce a slight delay (100ms) to ensure all environment resources are loaded, 
        // which often resolves "URL protocol not supported" errors in sandboxed contexts.
        setTimeout(() => {
            // Registering sw.js at the root scope '/'
            navigator.serviceWorker.register('/sw.js')
            .then(registration => {
                console.log('Service Worker registered successfully with scope: ', registration.scope);
            })
            .catch(error => {
                console.error('Service Worker registration failed: ', error);
            });
        }, 100); 
        });
    }

    /**
     * Shows the main application content after a delay.
     * This function is called after all initial app logic is run.
     */
    function showAppContent() {
        const splash = document.getElementById('custom-splash');
        const content = document.getElementById('app-content');

        // Start the fade-out process
        splash.style.opacity = '0'; 

        // After the fade transition is complete (300ms), hide it completely
        setTimeout(() => {
            splash.style.display = 'none';
            content.classList.remove('hidden');
        }, 300); // 300ms matches the CSS transition time
    }
</script>

<!-- START USER'S APPLICATION LOGIC SCRIPT -->
<script>    
    // Global variable to capture the exact time the script started (content load time)    
    const scriptLoadTime = new Date();        

    // --- HTS Conversion Logic (Shared) ---    
    function getHTSNotation(gregorianYear) {        
        // --- HTS Conversion Constants ---        
        const BASE_GREGORIAN_YEAR = 2023;        
        const HTS_BASE_YEAR = 40000;        
        const EPOCH_LENGTH = 50000;        
        const ALPHABET = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

        // Gregorian year equivalent of HTS Year 0 (2023 - 40000 = -37977)        
        const HTS_YEAR_0_GREGORIAN = BASE_GREGORIAN_YEAR - HTS_BASE_YEAR;        
        const yearsSinceHTS0 = gregorianYear - HTS_YEAR_0_GREGORIAN;

        // Calculate Epoch components        
        const epochIndex = Math.floor(yearsSinceHTS0 / EPOCH_LENGTH);        
        const yearWithinEpoch = yearsSinceHTS0 % EPOCH_LENGTH;                

        // Calculate Supercycle and Epoch Letter        
        const supercycleNumber = Math.floor(epochIndex / ALPHABET.length) + 1;        
        const letterIndex = epochIndex % ALPHABET.length;        
        const epochLetter = ALPHABET[letterIndex];

        // Format outputs        
        const HTS_Year_Formatted = String(yearWithinEpoch).padStart(5, '0');        
        const HTS_Epoch_Year = `${epochLetter}${HTS_Year_Formatted}`;        
        const HTS_Full = `${supercycleNumber}${epochLetter}${HTS_Year_Formatted}`;                

        return { HTS_Epoch_Year, HTS_Full, gregorianYear };    
    }    
    // ------------------------------------

    // --- FUNCTION 1: Gregorian to HTS Conversion ---    
    function convertToHTS() {        
        const yearInput = document.getElementById('gregorianYear').value;        
        const resultDiv = document.getElementById('result-convert');        
        const gregorianYear = parseInt(yearInput);

        if (isNaN(gregorianYear) || gregorianYear < -40000) {            
            resultDiv.innerHTML = "❌ Please enter a valid Gregorian year (e.g., 2025). The system starts 40,000 years before 2023.";            
            return;        
        }                

        const htsData = getHTSNotation(gregorianYear);

        // Reverted HTML structure        
        resultDiv.innerHTML = `            
            <h3>✅ Conversion Complete</h3>            
            <p>The Gregorian Year ${htsData.gregorianYear} AD is:</p>            
            <p style="font-size: 2.5em; color: #007bff; margin: 10px 0;">                
                ${htsData.HTS_Epoch_Year}            
            </p>            
            <p>Full HTS Notation (Supercycle/Epoch/Year):</p>            
            <p style="font-size: 1.5em; color: #1a1a2e; margin: 5px 0;">                
                **${htsData.HTS_Full}** </p>        
        `;    
    }

    // --- FUNCTION 2: HTS to Gregorian Conversion ---    
    function convertHTSToGregorian() {        
        const htsInput = document.getElementById('htsYearInput').value.trim().toUpperCase();        
        const resultDiv = document.getElementById('result-hts-convert');

        // Constants from HTS logic        
        const BASE_GREGORIAN_YEAR = 2023;        
        const HTS_BASE_YEAR = 40000;        
        const EPOCH_LENGTH = 50000;        
        const ALPHABET = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";        
        const HTS_YEAR_0_GREGORIAN = BASE_GREGORIAN_YEAR - HTS_BASE_YEAR;

        // Regex to match the full notation: [Supercycle (optional)] [Epoch Letter] [5-digit Year]        
        const match = htsInput.match(/^(\d*)?([A-Z])(\d{5})$/); 

        if (!match) {            
            resultDiv.innerHTML = "❌ Invalid HTS format. Please use the full notation, e.g., **1B40000** (Supercycle, Epoch Letter, 5-digit Year).";            
            return;        
        }

        const supercycleStr = match[1];        
        const epochLetter = match[2];        
        const yearWithinEpochStr = match[3];

        // Default to Supercycle 1 if not explicitly entered or entered as blank/empty string        
        const supercycleNumber = supercycleStr === '' ? 1 : parseInt(supercycleStr);         
        const yearWithinEpoch = parseInt(yearWithinEpochStr);

        if (yearWithinEpoch >= EPOCH_LENGTH) {             
            resultDiv.innerHTML = `❌ Invalid year. Year within epoch must be less than ${EPOCH_LENGTH}.`;            
            return;        
        }        
        if (isNaN(supercycleNumber) || supercycleNumber <= 0) {             
            resultDiv.innerHTML = "❌ Invalid Supercycle. Must be a positive integer.";             
            return;        
        }

        const letterIndex = ALPHABET.indexOf(epochLetter);                

        if (letterIndex === -1) {            
            resultDiv.innerHTML = "❌ Invalid Epoch Letter. Must be A-Z.";            
            return;        
        }

        // 1. Calculate the overall epoch index (zero-based)        
        const totalEpochs = (supercycleNumber - 1) * ALPHABET.length + letterIndex;

        // 2. Calculate the total years since HTS Year 0        
        const yearsSinceHTS0 = (totalEpochs * EPOCH_LENGTH) + yearWithinEpoch;

        // 3. Calculate the Gregorian Year        
        const gregorianYear = yearsSinceHTS0 + HTS_YEAR_0_GREGORIAN;

        // Reverted HTML structure        
        resultDiv.innerHTML = `            
            <h3>✅ Conversion Complete</h3>            
            <p>The HTS Year **${htsInput}** is equivalent to:</p>            
            <p style="font-size: 2.5em; color: #007bff; margin: 10px 0;">                
                ${gregorianYear} AD            
            </p>            
            <p>This corresponds to Supercycle **${supercycleNumber}**, Epoch **${epochLetter}**, and Year **${yearWithinEpoch}**.</p>        
        `;    
    }        

    // --- FUNCTION 3: Difference Calculator ---    
    function calculateDifference() {        
        const startYearInput = document.getElementById('startYear').value;        
        const endYearInput = document.getElementById('endYear').value;        
        const resultDiv = document.getElementById('result-difference');

        const startYear = parseInt(startYearInput);        
        const endYear = parseInt(endYearInput);

        if (isNaN(startYear) || isNaN(endYear)) {            
            resultDiv.innerHTML = "❌ Please enter valid numerical years in both fields.";            
            return;        
        }                

        const difference = Math.abs(endYear - startYear);                

        // Reverted HTML structure        
        resultDiv.innerHTML = `            
            <h3>✅ Duration Calculated</h3>            
            <p>The difference between **${startYear} AD** and **${endYear} AD** is:</p>            
            <p style="font-size: 2.5em; color: #007bff; margin: 10px 0;">                
                ${difference} Years            
            </p>            
            <p>This is equivalent to a duration of **${difference} HTS Years.**</p>        
        `;    
    }

    // --- FUNCTION 4: Future Year Projector ---    
    function projectFutureYear() {        
        const baseYearInput = document.getElementById('baseYear').value;        
        const yearsToAddInput = document.getElementById('yearsToAdd').value;        
        const resultDiv = document.getElementById('result-project');

        const baseYear = parseInt(baseYearInput);        
        const yearsToAdd = parseInt(yearsToAddInput);

        if (isNaN(baseYear) || isNaN(yearsToAdd) || yearsToAdd < 0) {            
            resultDiv.innerHTML = "❌ Please enter valid, non-negative numbers for the start year and years to add.";            
            return;        
        }                

        // --- VALIDATION: Limit resulting year to 12 billion ---        
        const MAX_GREGORIAN_LIMIT = 12000000000;         
        const futureGregorianYear = baseYear + yearsToAdd;

        if (futureGregorianYear > MAX_GREGORIAN_LIMIT) {            
            resultDiv.innerHTML = `                
                <p class="warning-text">⚠️ **Input Limit Exceeded**</p>                
                <p class="warning-text">While we fully expect the Earth to survive for greater than 13 billion years, we limit that input so that years displayed may not exceed **12 billion**.</p>                
                <p>Please enter fewer years to add.</p>            
            `;            
            return;        
        }        
        // --- END VALIDATION ---                

        const htsData = getHTSNotation(futureGregorianYear);

        // Reverted HTML structure        
        resultDiv.innerHTML = `            
            <h3>✅ Projection Calculated</h3>            
            <p>Adding **${yearsToAdd} years** to **${baseYear} AD** results in **${futureGregorianYear} AD**.</p>            
            <p>The HTS Year will be:</p>            
            <p style="font-size: 2.5em; color: #007bff; margin: 10px 0;">                
                ${htsData.HTS_Epoch_Year}            
            </p>            
            <p>Full HTS Notation: **${htsData.HTS_Full}**</p>        
        `;    
    }        

    // --- FUNCTION 5: Display Load Time (Adjusted for Central Time) ---    
    function displayLoadTime() {        
        const lastUpdatedElement = document.getElementById('last-updated');

        const updatedOptions = {            
            year: 'numeric',            
            month: 'short',            
            day: '2-digit',            
            hour: '2-digit',            
            minute: '2-digit',            
            second: '2-digit',            
            timeZoneName: 'short',            
            // Using America/Chicago for Central Time (CT)             
            timeZone: 'America/Chicago'         
        };

        const loadTimeStr = scriptLoadTime.toLocaleString('en-US', updatedOptions);

        lastUpdatedElement.innerHTML = `            
            <p>The content was last loaded/updated at:</p>            
            <p style="font-size:1.1em; color: #1a1a2e;"><strong>${loadTimeStr}</strong></p>            
            <p style="margin-top: 10px; font-size:0.8em;">(Time is Central Time - CT)</p>        
        `;    
    }

    // Set the default year and run all conversions on load (The main app initialization function)    
    function initializeApp() {
        const currentYear = new Date().getFullYear();                 

        // 1. Set default for Conversion tool (Gregorian to HTS)        
        document.getElementById('gregorianYear').value = currentYear;        
        convertToHTS();

        // 2. Set default for HTS to Gregorian tool        
        const currentHTS = getHTSNotation(currentYear);        
        document.getElementById('htsYearInput').value = currentHTS.HTS_Full;        
        convertHTSToGregorian();

        // 3. Set defaults for Difference tool        
        document.getElementById('startYear').value = currentYear;        
        document.getElementById('endYear').value = currentYear + 50;         
        calculateDifference();

        // 4. Set defaults for Projection tool        
        document.getElementById('baseYear').value = currentYear;        
        document.getElementById('yearsToAdd').value = 100;        
        projectFutureYear();

        // 5. Display the load time in CT        
        displayLoadTime();
    }


    // Run initialization logic first, then enforce the 4-second splash screen
    document.addEventListener('DOMContentLoaded', () => {        
        // 1. Run all calculations to prepare the content (while it's still hidden)
        initializeApp();

        // 2. Set the desired 4000ms (4 second) minimum delay
        const MINIMUM_SPLASH_TIME = 4000; 
        
        // 3. Wait for the minimum time, then call the function to reveal the app
        setTimeout(showAppContent, MINIMUM_SPLASH_TIME);
    });
</script>
</body>
</html>
